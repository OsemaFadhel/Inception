version : '3.7'

services:
    nginx:
        image: ./srcs/nginx
        ports:
            - '80:80'
            - '443:443'
        volumes:
            - ./srcs/nginx.conf:/etc/nginx/nginx.conf
            - ./srcs/ssl:/etc/ssl
            - ./srcs/www:/var/www
        networks:
            - inception

    wordpress:
        image: ./srcs/wordpress
        ports:
            - "80:80"
        volumes:
            - wordpress:/var/www/html
        environment:
            WORDPRESS_DB_HOST: mariadb
            WORDPRESS_DB_USER: root
            WORDPRESS_DB_PASSWORD: password
            WORDPRESS_DB_NAME: wordpress
        networks:
            - inception

    mariadb:
        image: ./srcs/mariadb
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_DATABASE: wordpress
        volumes:
            - mariadb:/var/lib/mysql
        networks:
            - inception

    ftp:
        image: fauria/vsftpd
        deploy:
            replicas: 1
            resources:
                limits:
                    cpus: "0.1"
                    memory: 50M
            restart_policy:
                condition: on-failure
        environment:
            FTP_USER: user
            FTP_PASS: password
        ports:
            - "21:21"
        volumes:
            - ftp:/home/vsftpd
        networks:
            - inception

volumes:
    mariadb:
        name: mariadb
        driver: local
    wordpress:
        name: wordpress
        driver: local

networks:
    inception:

